---
title: "Data 624 Homework 2"
subtitle: "Week 3 Decomposition"
author: "Stephen Haslett"
date: "9/1/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(fpp3)
library(DT)
library(feasts)
```

### Exercise 3.1
**Consider the GDP information in _global_economy_. Plot the GDP per capita for each country over time. Which country has the highest GDP per capita? How has this changed over time?**.


**_A. Plot the GDP per capita for each country over time. How has this changed over time_**?

_Looking at the below plot, we can say that there is an upward trend in GDP over time_.


```{r fig.width=8, exercise3.1A, eval=TRUE, message=FALSE, warning=FALSE}
tsibble(global_economy, key = Code, index = Year) %>%
  autoplot(GDP/Population, show.legend = FALSE) +
  labs(title = 'GDP Per Capita For All Countries',
       y = 'US Dollars')
```


**_B. Which country has the highest GDP per capita_**?

_The below plot shows us that the country with the highest GDP is Monaco. Monaco's GDP reached $185000 US dollars in 2014_.

```{r, exercise3.1B, eval=TRUE, message=FALSE, warning=FALSE}
country_gdp <- global_economy %>%
  mutate('GDP_per_capita' = GDP / Population) %>%
  select(Country, Year, GDP_per_capita) %>%
  arrange(desc(GDP_per_capita)) %>%
  head(10)

country_with_highest_gdp <- tsibble(country_gdp, key = Country, index = Year)
autoplot(country_with_highest_gdp) +
  labs(title = 'Country with The Highest GDP',
       y ='US Dollars')
```


\ 

### Exercise 3.2
**For each of the following series, make a graph of the data. If transforming seems appropriate, do so and describe the effect**.

**_A. United States GDP from global_economy_**

```{r exercise3.2US-GDP, eval=TRUE, message=FALSE, warning=FALSE}
tsibble(global_economy, key = Code, index = Year) %>%
  filter(Country == 'United States') %>%
  autoplot(GDP/Population) +
  labs(title = 'United States GDP', y = 'US Dollars') +
  geom_line(col = '#006400') +
  theme(panel.grid.major.x = element_line(size = 0.15, linetype = 'solid', color = '#808080'),
        panel.grid.minor.x = element_line(size = 0.15, linetype = 'solid', color = '#696969'),
        panel.grid.major.y = element_line(size = 0.15, linetype = 'solid', color = '#2F4F4F'))

```


**_B. Slaughter of Victorian “Bulls, bullocks and steers” in aus_livestock_**
```{r fig.width = 14, exercise3.2AusLivestock, eval=TRUE, message=FALSE, warning=FALSE}
aus_livestock %>%
  filter(Animal == 'Bulls, bullocks and steers', State == 'Victoria') %>%
  autoplot(Count) +
  labs(title = 'Slaughter of Victorian “Bulls, Bullocks and Steers"', y = 'Count') +
  geom_line(col = '#DC143C') +
  theme(panel.grid.major.x = element_line(size = 0.15, linetype = 'solid', color = '#808080'),
        panel.grid.minor.x = element_line(size = 0.15, linetype = 'solid', color = '#696969'),
        panel.grid.major.y = element_line(size = 0.15, linetype = 'solid', color = '#2F4F4F'))
```


**_C. Victorian Electricity Demand from vic_elec_**
```{r fig.width=10, exercise3.2ElectricityDemand, eval=TRUE, message=FALSE, warning=FALSE}
vic_elec %>%
  autoplot(Demand) +
  labs(title = 'Victorian Electricity Demand', y = 'Demand') +
  geom_line(col = '#9932CC') +
  theme(panel.grid.major.x = element_line(size = 0.15, linetype = 'solid', color = '#808080'),
        panel.grid.minor.x = element_line(size = 0.15, linetype = 'solid', color = '#696969'),
        panel.grid.major.y = element_line(size = 0.15, linetype = 'solid', color = '#2F4F4F'))
```


**_D. Gas production from aus_production_**
```{r fig.width=10, exercise3.2GasProduction, eval=TRUE, message=FALSE, warning=FALSE}
aus_production %>%
  autoplot(Gas) +
  labs(title = 'Gas Production') +
  geom_line(col = '#FF8C00') +
  theme(panel.grid.major.x = element_line(size = 0.15, linetype = 'solid', color = '#808080'),
        panel.grid.minor.x = element_line(size = 0.15, linetype = 'solid', color = '#696969'),
        panel.grid.major.y = element_line(size = 0.15, linetype = 'solid', color = '#2F4F4F'))
```

\ 

### Exercise 3.3
**Why is a Box-Cox transformation unhelpful for the canadian_gas data**?

```{r fig.width=10, exercise3.3CanadianGasProduction, eval=TRUE, message=FALSE, warning=FALSE}
canadian_gas %>%
  autoplot(Volume) +
  labs(title = 'Canadian Gas Production') +
  geom_line(col = '#1E90FF') +
  theme(panel.grid.major.x = element_line(size = 0.15, linetype = 'solid', color = '#808080'),
        panel.grid.minor.x = element_line(size = 0.15, linetype = 'solid', color = '#696969'),
        panel.grid.major.y = element_line(size = 0.15, linetype = 'solid', color = '#2F4F4F'))
```


\ 

### Exercise 3.4
**What Box-Cox transformation would you select for your retail data (_from Exercise 8 in Section 2.10_)**?

_Using the **boxcox()** function's default method to find an optimal lambda, we get a lambda value of -0.02 that we use to transform the "Turnover" response variable_.

```{r fig.width=10, exercise3.4ausRetailData, eval=TRUE, message=FALSE, warning=FALSE}
set.seed(12345678)
myseries <- aus_retail %>%
  filter(`Series ID` == sample(aus_retail$`Series ID`, 1))

myseries %>%
  autoplot(Turnover) +
  labs(title = 'Original Monthly Australian Retail Data', x = 'Month') +
  geom_line(col = '#2E8B57') +
  theme(panel.grid.major.x = element_line(size = 0.15, linetype = 'solid', color = '#808080'),
        panel.grid.minor.x = element_line(size = 0.15, linetype = 'solid', color = '#696969'),
        panel.grid.major.y = element_line(size = 0.15, linetype = 'solid', color = '#2F4F4F'))
```

```{r fig.width=10, exercise3.4ausRetailBoxCox, eval=TRUE, message=FALSE, warning=FALSE}
lambda <- myseries %>% features(Turnover, features = guerrero)

myseries %>%
  autoplot(box_cox(Turnover, lambda$lambda_guerrero)) +
  labs(title = 'Monthly Australian Retail Data Box-Cox Transformation', y = 'Turnover', x = 'Month') +
  geom_line(col = '#FA8072') +
  theme(panel.grid.major.x = element_line(size = 0.15, linetype = 'solid', color = '#808080'),
        panel.grid.minor.x = element_line(size = 0.15, linetype = 'solid', color = '#696969'),
        panel.grid.major.y = element_line(size = 0.15, linetype = 'solid', color = '#2F4F4F'))
```


```{r, lambdaValue, eval=TRUE, message=FALSE, warning=FALSE, echo=FALSE}
paste('The Lambda value for the above transformation is', '', round(lambda$lambda_guerrero, 2))
```

\ 

### Exercise 3.5
**For the following series, find an appropriate Box-Cox transformation in order to stabilise the variance. Tobacco from aus_production, Economy class passengers between Melbourne and Sydney from ansett, and Pedestrian counts at Southern Cross Station from pedestrian**.


\ 

### Exercise 3.7
**Consider the last five years of the Gas data from aus_production**.

```{r exercise3.7, eval=TRUE, message=FALSE, warning=FALSE}
gas <- tail(aus_production, 5*4) %>% select(Gas)
```

**3.7 A. _Plot the time series. Can you identify seasonal fluctuations and/or a trend-cycle_**?

```{r exercise3.7A, eval=TRUE, message=FALSE, warning=FALSE}
gas %>%
  autoplot() +
  labs(title = 'Last Five Years of Gas Data') +
  geom_line(col = '#DAA520') +
  theme(panel.grid.major.x = element_line(size = 0.15, linetype = 'solid', color = '#808080'),
        panel.grid.minor.x = element_line(size = 0.15, linetype = 'solid', color = '#696969'),
        panel.grid.major.y = element_line(size = 0.15, linetype = 'solid', color = '#2F4F4F'))
```


**3.7 B. _Use classical_decomposition with type=multiplicative to calculate the trend-cycle and seasonal indices_**.

```{r exercise3.7B, eval=TRUE, message=FALSE, warning=FALSE}
gas %>%
  model(classical_decomposition(Gas, type = 'multiplicative')) %>%
  components() %>%
  autoplot() +
  labs(title = 'Last Five Years of Gas Data')
```


**3.7 C. _Do the results support the graphical interpretation from part a_**?


**3.7 D. _Compute and plot the seasonally adjusted data_**.


**3.7 E. _Change one observation to be an outlier (e.g., add 300 to one observation), and recompute the seasonally adjusted data. What is the effect of the outlier_**.


**3.7 F. _Does it make any difference if the outlier is near the end rather than in the middle of the time series_**?


\ 

### Exercise 3.8
**Recall your retail time series data (from Exercise 8 in Section 2.10). Decompose the series using X-11. Does it reveal any outliers, or unusual features that you had not noticed previously**?


\ 

### Exercise 3.9
**Figures 3.19 and 3.20 show the result of decomposing the number of persons in the civilian labour force in Australia each month from February 1978 to August 1995**.


**3.9 A. _Write about 3–5 sentences describing the results of the decomposition. Pay particular attention to the scales of the graphs in making your interpretation_**.


**3.9 B. _Is the recession of 1991/1992 visible in the estimated components_**?


