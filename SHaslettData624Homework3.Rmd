---
title: "Data 624 Homework 3"
subtitle: "Week 4 Forecasting"
author: "Stephen Haslett"
date: "9/14/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(fpp3)
library(DT)
library(feasts)
library(seasonal)
library(tsibble)
library(lubridate)
library(forecast)
```

### Exercise 5.1
**Produce forecasts for the following series using whichever of _NAIVE(y)_, _SNAIVE(y)_ or _RW(y ~ drift())_ is more appropriate in each case:**.

- **Australian Population (_global_economy_)**
- **Bricks (_aus_production_)**
- **NSW Lambs (_aus_livestock_)**
- **Household wealth (_hh_budget_)**.
-**Australian takeaway food turnover (_aus_retail_)**.


**_A. Australian Population (global_economy)_**.


```{r 5.1A, eval=TRUE, message=FALSE, warning=FALSE}
global_economy %>%
  filter(Code == 'AUS') %>% 
  model(RW(Population ~ drift())) %>% 
  forecast(h = '15 years') %>% 
  autoplot(global_economy) +
  labs(title = 'Australian Population Drift Forecast')
```


**_B. Bricks (aus_production)_**.


```{r 5.1B, eval=TRUE, message=FALSE, warning=FALSE}
aus_production %>% 
  # Remove NAs from the "Bricks" column.
  drop_na(Bricks) %>%
  # Apply a seasonal naive forcast and plot the data.
  model(SNAIVE(Bricks)) %>% 
  forecast(h = '15 years') %>% 
  autoplot(aus_production) +
  labs(title = 'Australian Clay Brick Production Seasonal Naive Forcast')
```

**_C. NSW Lambs (aus_livestock)_**.


```{r 5.1C, eval=TRUE, message=FALSE, warning=FALSE}
# Disable scientific numbers for readability purposes.
options(scipen = 999)

# Filter the "aus_livestock" dataset by Animal (Lambs) and State (New South Wales).
NSWLambs <- aus_livestock %>% 
  filter(Animal == 'Lambs' & State == 'New South Wales')

# Apply a seasonal naive forcast and plot the data.
NSWLambs %>%
  model(SNAIVE(Count)) %>% 
  forecast(h = '15 years') %>% 
  autoplot(NSWLambs) +
  labs(title = 'New South Wales Lambs Seasonal Naive Forecast')
  
```

**_D. Household wealth (hh_budget)_**.


```{r 5.1D, eval=TRUE, message=FALSE, warning=FALSE}
hh_budget %>%
  model(RW(Wealth ~ drift())) %>% 
  forecast(h = '15 years') %>% 
  autoplot(hh_budget) +
  labs(title = 'Household Wealth Drift Forecast')
```

**_E. Australian takeaway food turnover (aus_retail)_**.


```{r 5.1E, fig.height=15, fig.width=10, eval=TRUE, message=FALSE, warning=FALSE}
TakeAwayFoodTurnover <- aus_retail %>%
  filter(Industry == 'Cafes, restaurants and takeaway food services')
TakeAwayFoodTurnover %>%
  model(RW(Turnover ~ drift())) %>% 
  forecast(h = '15 years') %>% 
  autoplot(TakeAwayFoodTurnover) +
  labs(title = 'Australian Takeaway Food Turnover Drift Forecast')
```


\ 

### Exercise 5.2
**Use the Facebook stock price data set (_gafa_stock_) to do the following:**.

**a. Produce a time plot of the series**.

**b. Produce forecasts using the drift method and plot them**.

**c. Show that the forecasts are identical to extending the line drawn between the first and last observations**.

**d. Try using some of the other benchmark functions to forecast the same data set. Which do you think is best? Why**?


**_A. Produce a time plot of the series_**.

```{r 5.2A, eval=TRUE, message=FALSE, warning=FALSE}
facebook_stock <- gafa_stock %>% 
  filter(Symbol == 'FB')

facebook_stock %>% autoplot(Close) +
  labs(title = 'Facebook Stock Time Plot',
       y = 'Closing Value',
       x = 'Date')
```


**_B. Produce forecasts using the drift method and plot them_**.
```{r 5.2B, eval=TRUE, message=FALSE, warning=FALSE}
# Due to an issue with the "gafa_stock" dataset, I was getting the following error -
# "Error: Problem with `mutate()` input `RW(Close ~ drift())`. x `new_data.tbl_ts(.data, round(n))`
# can't handle tsibble of irregular interval. ℹ Input `RW(Close ~ drift())` is `(function (object, ...)".
# To fix this issue, I altered the suggested fix for this issue documented here - https://github.com/tidyverts/tsibbledata/issues/8. 
facebook_stock <- gafa_stock %>%
  filter(Symbol == "FB", year(Date) >= 2018) %>%
  mutate(Date = Date) %>%
  update_tsibble(index = Date, regular = TRUE)

fb_forecast <- facebook_stock %>%
  fill_gaps() %>% 
  model(RW(Close ~ drift())) %>%
  forecast(h = 15)

fb_forecast %>% autoplot(facebook_stock) +
  labs(title = 'Facebook Stock Drift Forcast',
       y = 'Closing Value',
       x = 'Date')
```


**_C. Show that the forecasts are identical to extending the line drawn between the first and last observations_**.
```{r eval=TRUE, message=FALSE, warning=FALSE}
fb_forecast %>% autoplot(facebook_stock) +
  labs(title = 'Facebook Stock Drift Forcast',
       y = 'Closing Value',
       x = 'Date') +
  geom_segment(
    aes(
      xend = Date[length(Date)],
      yend = Close[length(Close)],
      x = Date[1],
      y = Close[1]
    ),
    linetype = 'dashed',
    color = '#DC143C'
  )
```


**_D Try using some of the other benchmark functions to forecast the same data set. Which do you think is best? Why_**?
```{r eval=TRUE, message=FALSE, warning=FALSE}
```

\ 

### Exercise 5.3
**Apply a seasonal naïve method to the quarterly Australian beer production data from 1992. Check if the residuals look like white noise, and plot the forecasts. The following code will help**.

_TEXT_.

```{r eval=TRUE, message=FALSE, warning=FALSE}
```


```{r eval=TRUE, message=FALSE, warning=FALSE}
```



\ 

### Exercise 5.4
**Repeat the previous exercise using the Australian Exports series from global_economy and the Bricks series from aus_production. Use whichever of NAIVE() or SNAIVE() is more appropriate in each case**.

_TEXT_.

```{r eval=TRUE, message=FALSE, warning=FALSE}

```

```{r eval=TRUE, message=FALSE, warning=FALSE}

```


```{r eval=TRUE, message=FALSE, warning=FALSE, echo=FALSE}

```

\ 

### Exercise 5.7
**For your retail time series (from Exercise 8 in Section 2.10):**.

**a. Create a training dataset consisting of observations before 2011 using**:

```{r eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE}
#myseries_train <- myseries %>%
#  filter(year(Month) < 2011)
```

**b. Check that your data have been split appropriately by producing the following plot**.

```{r eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE}
##autoplot(myseries, Turnover) +
  ##autolayer(myseries_train, Turnover, colour = "red")
```

**c. Fit a seasonal naïve model using SNAIVE() applied to your training data (myseries_train)**.

```{r eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE}
##fit <- myseries_train %>%
  ##model(SNAIVE())
```

**d. Check the residuals**.

```{r eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE}
##fit %>% gg_tsresiduals()
```
  **Do the residuals appear to be uncorrelated and normally distributed**?

**e. Produce forecasts for the test data**

```{r eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE}
##fc <- fit %>%
  ##forecast(new_data = anti_join(myseries, myseries_train))
##fc %>% autoplot(myseries)

```

**f. Compare the accuracy of your forecasts against the actual values**.

```{r eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE}
##fit %>% accuracy()
##fc %>% accuracy(myseries)
```

**g. How sensitive are the accuracy measures to the amount of training data used**?


**_A._**

```{r eval=TRUE, message=FALSE, warning=FALSE}

```


```{r eval=TRUE, message=FALSE, warning=FALSE}

```


```{r eval=TRUE, message=FALSE, warning=FALSE, echo=FALSE}

```

\ 


